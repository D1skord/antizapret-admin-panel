# Gemini Project Context: antizapret-admin-panel

Этот файл содержит техническую сводку по проекту для быстрого введения в курс дела в будущих сессиях.

## 1. Обзор проекта

-   **Цель:** Монолитное веб-приложение для управления VPN-сервером AntiZapret (OpenVPN/WireGuard/AmneziaWG).
-   **Архитектура:** Бэкенд на Go, фронтенд на Vue.js. Проект компилируется в **единый исполняемый файл**, который содержит и сервер, и веб-интерфейс.
-   **Файловая структура:**
    -   `/`: Исходный код бэкенда на Go.
    -   `/frontend`: Исходный код фронтенда на Vue.js.
    -   `/internal`: Внутренние пакеты Go (API-хендлеры, middleware).
        -   `/api`: HTTP хендлеры (Gin).
        -   `/entity`: Структуры данных.
        -   `/repository`: Работа с файловой системой (чтение/запись конфигов VPN).
        -   `/service`: Бизнес-логика.
    -   `/mock_fs`: Эмуляция файловой системы сервера для локальной разработки (ключи, конфиги).
    -   `/deploy`: Скрипты и конфиги для Linux-деплоя (systemd service, uninstall).
    -   `.github/workflows`: CI/CD для сборки релизов.

## 2. Технический стек

-   **Бэкенд:** Go с фреймворком `gin-gonic/gin`.
-   **Фронтенд:** Vue.js 3 с Vite, Pinia для управления состоянием, Tailwind CSS для стилей.
-   **Сборка:** `Makefile` для автоматизации задач. `make build` собирает фронтенд и затем компилирует Go-приложение.

## 3. Ключевые концепции

### Встраивание фронтенда

В `main.go` используется директива `//go:embed frontend/dist/*` для встраивания скомпилированных файлов фронтенда непосредственно в исполняемый файл Go. Сервер раздает их как статическую файловую систему.

### Конфигурация

Приложение настраивается через **переменные окружения** (`ADMIN_PASSWORD`, `CLIENT_SCRIPT_PATH` и т.д.). Если переменные не заданы, используются значения по умолчанию для локальной разработки с моковой файловой системой (`mock_fs`).

### Аутентификация

-   **Логин:** `POST /api/login`. В качестве токена используется сам пароль администратора.
-   **Хранение токена:** Токен хранится в Pinia-хранилище `frontend/src/stores/auth.js`.
-   **Глобальная отправка токена:** Файл **`frontend/src/api/index.js`** настраивает глобальный **перехватчик запросов (interceptor)** для `axios`. Эта функция автоматически "перехватывает" каждый исходящий запрос и добавляет в него заголовок `X-Auth-Token`, если токен есть в хранилище Pinia.
-   **Глобальная обработка 401:** Там же настроен перехватчик ответов, который при получении статуса `401 Unauthorized` автоматически выполняет `logout`.

## 4. Процесс сборки и релиза

Проект распространяется как `.tar.gz` архив через GitHub Releases.

1.  **GitHub Actions (`release.yml`)**:
    -   При пуше тега `v*` запускается сборка.
    -   Собирается фронтенд (`npm run build`).
    -   Собирается бэкенд для Linux (`GOOS=linux GOARCH=amd64`).
    -   Формируется архив, содержащий: бинарник, `deploy/antizapret-admin.service`, `deploy/uninstall.sh`.

2.  **Установка (`install.sh`)**:
    -   Пользователь запускает скрипт (через curl | bash).
    -   Скрипт скачивает последний релиз, распаковывает.
    -   Обновляет бинарник в `/usr/local/bin/antizapret-admin-panel`.
    -   Обновляет systemd unit в `/etc/systemd/system`.
    -   **Устанавливает скрипт удаления** в `/usr/local/bin/antizapret-admin-uninstall`.

## 5. Особенности разработки

-   **Локальный запуск:** `make dev-backend` (использует `air` для хот-релоада) + `make dev-frontend`.
-   **Mock FS:** В локальной разработке пути к конфигам (`OPENVPN_CLIENTS_PATH` и др.) указывают на папку `mock_fs/`.

## 6. Реализованные фичи (примеры)

### Скачивание конфигов клиента
-   Эндпоинт `GET /api/clients/:id/config` (защищен токеном) отдает файл `.ovpn` или `.conf`.
-   Фронтенд использует `axios` с `responseType: 'blob'` и создает временную ссылку для скачивания, прозрачно обрабатывая аутентификацию.